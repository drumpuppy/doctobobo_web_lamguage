<!DOCTYPE html>  
<html lang="fr">
<html>  
    <link rel="stylesheet" href="my_space.css">
    <head>  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mon espace</title>  
 </head>  

 <body>
    
    <ul class="menu">
        <li>
          <a href="landing_page.html" class="actif">Doctobobo</a>
        </li>
        <li>
            <a href="connection_page.html" class="actif">Se connecter</a>
        </li>
        <li>
            <a href="meeting.html" class="actif">Mes rendez-vous</a>
        </li>
        <li>
            <a href="my_space.html" class="actif">Mon espace</a>
        </li>
    </ul>

    <br />

    <li>
        <button id="logout-btn">Se déconnecter</button>
    </li>

    <div class="données_perso">
        <h1 style="color: rgb(20, 125, 200)">Mes données personnelles :</h1>
        
        <p>Nom: <span id="user-last-name"></span></p>
        <p>Prénom: <span id="user-first-name"></span></p>
        <p>Date de naissance: <span id="user-birthdate"></span></p>
        <p>Email: <span id="user-email"></span></p>
    </div>

    <br />
    <br />

    <div class="rdv_passé">
        <h1 style="color: rgb(20, 125, 200)">Mes rendez-vous passés :</h1>
        
        <form>
        </form>
    </div>

    <script>
        function fetchData() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', './phpDatabase/get_user_data.php', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            document.getElementById('user-last-name').innerText = response.data.Nom_Medecin || response.data.Nom_Patient;
                            document.getElementById('user-first-name').innerText = response.data.Prenom_Medecin || response.data.Prenom_Patient;
                            document.getElementById('user-birthdate').innerText = response.data.DateNaissance;
                            document.getElementById('user-email').innerText = response.data.email;
                        } else {
                            // Redirect to the login page if the session is not set or expired
                            window.location.href = 'connection_page.html';
                        }
                    }
                }
            };
            xhr.send();
        }
        
        // Fetch user data when the page is loaded
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>

    <script>
        document.getElementById('logout-btn').addEventListener('click', function() {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', './phpDatabase/logout.php', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    window.location.href = 'connection_page.html';
                }
            }
        };
        xhr.send();
        });
    </script>

  </body>
</html>